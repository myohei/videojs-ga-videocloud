/*
* videojs-ga - v0.4.1 - 2016-06-13
* Copyright (c) 2016 Michael Bensoussan
* Licensed MIT
*/
(function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};videojs.plugin("ga",function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;return null==b&&(b={}),C=document.createElement("a"),C.href=document.referrer,self!==top&&"preview-players.brightcove.net"===window.location.host&&(C.hostname="studio.brightcove.com")?void videojs.log("Google analytics plugin will not track events in Video Cloud Studio"):(B=this,f={},this.options()["data-setup"]&&(w=JSON.parse(this.options()["data-setup"]),w.ga&&(f=w.ga)),h=["player_load","video_load","percent_played","start","end","seek","play","pause","resize","volume_change","error","fullscreen"],p=b.eventsToTrack||f.eventsToTrack||h,z=b.percentsPlayedInterval||f.percentsPlayedInterval||10,m=b.eventCategory||f.eventCategory||"Brightcove Player",g=b.eventLabel||f.eventLabel,I=b.sendbeaconOverride||!1,y=[],K=!1,k=!1,F=E=0,G=!1,n="",e="",N=!1,O="videoPlayerTracker",o={video_load:"Video Load",percent_played:"Percent played",start:"Media Begin",seek_start:"Seek start",seek_end:"Seek end",play:"Media Play",pause:"Media Pause",error:"Error",fullscreen_exit:"Fullscreen Exited",fullscreen_enter:"Fullscreen Entered",resize:"Resize",volume_change:"Volume Change",player_load:"Player Load",end:"Media Complete"},r=function(a){return b.eventNames&&b.eventNames[a]?b.eventNames[a]:f.eventNames&&f.eventNames[a]?f.eventNames[a]:o[a]?o[a]:a},i=b.allowedDomain||f.allowedDomain,console.log("=== domain"+i),M=b.tracker||f.tracker,("players.brightcove.net"===window.location.host||"preview-players.brightcove.net"===window.location.host)&&M&&(!function(a,b,c,d,e,f,g){return a.GoogleAnalyticsObject=e,a[e]=a[e]||function(){return(a[e].q=a[e].q||[]).push(arguments)},a[e].l=1*new Date,f=b.createElement(c),g=b.getElementsByTagName(c)[0],f.async=1,f.src=d,g.parentNode.insertBefore(f,g)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),d=function(a){var b;return console.log("=== create tracker "+a),N?void 0:(b={},a&&(b.clientId=a),b.name=O,console.log("=== create tracker:",b),ga("create",M,"auto",b),ga(O+".require","displayfeatures"),N=!0)},window.addEventListener("message",function(a){return console.log("==== event = "),console.log(a),console.log("======== "+i+" /origin:"+a.origin),a.origin.indexOf(i)<0?void console.log("=== RETURN RETURN RETURN ===  "):d(a.data)}),setTimeout(d,3e3)),c=/(\s|^)vjs-ad-(playing|loading)(\s|$)/,u=function(a){return c.test(a.el().className)},v=function(){u(B)||(n=g?g:B.mediainfo&&B.mediainfo.id?B.mediainfo.id+" | "+B.mediainfo.name:this.currentSrc().split("/").slice(-1)[0].replace(/\.(\w{3,4})(\?.*)?$/i,""),B.mediainfo&&B.mediainfo.id&&B.mediainfo.id!==e&&(e=B.mediainfo.id,y=[],K=!1,k=!1,F=E=0,G=!1,a.call(p,"video_load")>=0&&H(r("video_load"),!0)))},L=function(){var b,c,d,e,f;if(!u(B)){for(b=Math.round(this.currentTime()),c=Math.round(this.duration()),e=Math.round(b/c*100),d=f=0;99>=f;d=f+=z)e>=d&&a.call(y,d)<0&&(a.call(p,"percent_played")>=0&&0!==e&&H(r("percent_played"),!0,d),e>0&&y.push(d));a.call(p,"seek")>=0&&(F=E,E=b,Math.abs(F-E)>1&&(G=!0,H(r("seek_start"),!1,F),H(r("seek_end"),!1,E)))}},j=function(){u(B)||k||(H(r("end"),!0),k=!0)},A=function(){var a;u(B)||(a=Math.round(this.currentTime()),H(r("play"),!0,a),G=!1)},J=function(){return!u(B)&&a.call(p,"start")>=0&&!K?(H(r("start"),!0),K=!0):void 0},x=function(){var a,b;u(B)||(a=Math.round(this.currentTime()),b=Math.round(this.duration()),a===b||G||H(r("pause"),!0,a))},P=function(){var a;a=this.muted()===!0?0:this.volume(),H(r("volume_change"),!1,a)},D=function(){H(r("resize")+" - "+this.width()+"*"+this.height(),!0)},l=function(){var a;a=Math.round(this.currentTime()),H(r("error"),!0,a)},q=function(){var a;a=Math.round(this.currentTime()),("function"==typeof this.isFullscreen?this.isFullscreen():void 0)||("function"==typeof this.isFullScreen?this.isFullScreen():void 0)?H(r("fullscreen_enter"),!1,a):H(r("fullscreen_exit"),!1,a)},H=function(a,b,c){I?(console.log("======= override ======"),I(m,a,n,c,b)):window.ga?(console.log("=== domain:"+i),ga(function(){var d,e,f,g,h;for(e=ga.getAll(),console.log("tracker: == "+M),console.log(e),h=[],f=0,g=e.length;g>f;f++)d=e[f],console.log("===== "+d.get("trackingId")),M&&M!==d.get("trackingId")?h.push(void 0):(console.log("==== SEND SEND SEND "),h.push(d.send("event",{eventCategory:m,eventAction:a,eventLabel:n,eventValue:c,nonInteraction:b})));return h})):window._gaq?_gaq.push(["_trackEvent",m,a,n,c,b]):videojs.log("Google Analytics not detected")},a.call(p,"player_load")>=0&&(self!==top?(s=document.referrer,t=1):(s=window.location.href,t=0)),I?I(m,r("player_load"),s,t,!0):window.ga?ga("send","event",{eventCategory:m,eventAction:r("player_load"),eventLabel:s,eventValue:t,nonInteraction:!0}):window._gaq?_gaq.push(["_trackEvent",m,r("player_load"),s,t,!1]):videojs.log("Google Analytics not detected"),void this.ready(function(){return this.on("loadedmetadata",v),this.on("timeupdate",L),a.call(p,"end")>=0&&this.on("ended",j),a.call(p,"play")>=0&&this.on("play",A),a.call(p,"start")>=0&&this.on("playing",J),a.call(p,"pause")>=0&&this.on("pause",x),a.call(p,"volume_change")>=0&&this.on("volumechange",P),a.call(p,"resize")>=0&&this.on("resize",D),a.call(p,"error")>=0&&this.on("error",l),a.call(p,"fullscreen")>=0?this.on("fullscreenchange",q):void 0}))})}).call(this);